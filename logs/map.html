<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=10.0, user-scalable=yes">
    <title id="pageTitle">Zoomable Image Map</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #ffffff;
            touch-action: none; /* Prevents default touch behaviors */
        }
        #imageContainer {
            position: relative;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            cursor: grab;
            touch-action: none; /* Ensures touch events are handled by our code */
        }
        #zoomImage {
            position: absolute;
            transform-origin: 0 0;
            transition: transform 0.1s ease-out;
        }
    </style>
</head>
<body>
    <div id="imageContainer">
        <img id="zoomImage" src="" alt="Zoomable Image">
    </div>

    <script>
        // Get URL parameters for image and title
        const urlParams = new URLSearchParams(window.location.search);
        const imageUrl = urlParams.get('img') || 'https://via.placeholder.com/2000x2000';
        const pageName = urlParams.get('name') || 'Zoomable Image Map';

        // Set page title and image source
        document.getElementById('pageTitle').textContent = pageName;
        const imageContainer = document.getElementById('imageContainer');
        const img = document.getElementById('zoomImage');
        img.src = imageUrl;

        // Initialize variables
        let scale = 1;
        let pointX = 0;
        let pointY = 0;
        let start = { x: 0, y: 0 };
        let panning = false;
        let initialDistance = 0;
        let initialScale = 0;
        let touches = [];

        // Apply transformation to the image
        function setTransform() {
            img.style.transform = `translate(${pointX}px, ${pointY}px) scale(${scale})`;
        }

        // Center and scale the image to fit the viewport
        function centerImage() {
            const containerWidth = window.innerWidth;
            const containerHeight = window.innerHeight;
            const imgWidth = img.naturalWidth;
            const imgHeight = img.naturalHeight;

            if (imgWidth && imgHeight) {
                const scaleX = containerWidth / imgWidth;
                const scaleY = containerHeight / imgHeight;
                scale = Math.min(scaleX, scaleY); // Fit image fully within viewport
                pointX = (containerWidth - imgWidth * scale) / 2; // Center horizontally
                pointY = (containerHeight - imgHeight * scale) / 2; // Center vertically
                setTransform();
            }
        }

        // Initialize image on load
        img.onload = function() {
            centerImage();
        };

        // Handle image load errors